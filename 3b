<?php 

$ip2 = ip2long($argv[3]);

if(!isset($argv) || !isset($argv[2]))
die("Arguments are not set!");

if(!isset($argv[2]))
die("Arguments are not set!");

if ($db = sqlite_open($argv[2], 0666, $error)) {

$query = " SELECT adress FROM adress WHERE ( ( ~ ( ( 1 << (32-cidr))-1 ) ) & ip_result ) == ( ( ~ ( ( 1 << (32-cidr))-1 ) ) & " . $ip2 . " )";

$out = sqlite_query($db, $query);
while ($line=sqlite_fetch_array($out))
print $line["adress"] . "\r\n";
sqlite_close($db);

} 

?>

